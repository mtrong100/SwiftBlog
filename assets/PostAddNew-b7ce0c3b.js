import{u as K,r as l,e as Y,Q as p,j as e,R as A,b as P,_ as y,d as x,f as C,p as W,G as X,g as Z,h as ee}from"./index-7b34d9b5.js";import{u as se,I as te}from"./ImageUpload-faaeaa5b.js";import{s as ae}from"./slugify-94ae0324.js";import{l as oe,I as re,a as le,D as ne,S as ie,L as ce,O as de,R as me}from"./quill.snow-fcbabb17.js";import{R as i}from"./Radio-5bef7aad.js";import{c as ue,a as he,u as pe,F as c,L as d,I as xe,b as ge,o as fe}from"./yup-a3725464.js";import{H as je}from"./Heading-477794ce.js";import{B as be}from"./Button-3187d7fe.js";import{u as O,a as m,p as u}from"./constants-c6ed1daf.js";import{B as we,a as ye}from"./index.esm-6817c77a.js";import"./index.esm-002b4c65.js";oe.Quill.register("modules/imageUploader",re);const Ee=ue({title:he().required("Please enter your title !")}),F="fixed shadow-2xl w-[50px] h-[50px] rounded-full flex items-center justify-center dark:bg-whiteSoft  bg-colorDarkRedux text-white z-40 cursor-pointer dark:text-black font-bold text-2xl",Ie=()=>{const{userInfo:a}=K(),{control:r,handleSubmit:I,watch:E,setValue:g,getValues:T,reset:B,formState:{isValid:H,isSubmitting:v,errors:S}}=pe({mode:"onchange",resolver:fe(Ee),defaultValues:{title:"",slug:"",status:"pending",promote:"none",image:"",category:{},user:{}}}),f=E("status"),j=E("promote"),{image:b,progress:U,handleSelectImage:q,handleDeleteImage:V,handleResetUpLoad:$}=se(g,T),[N,L]=l.useState([]),[n,k]=l.useState(""),[w,G]=l.useState("");l.useEffect(()=>{async function s(){if(!a.email)return;const t=A(y(x,"users"),P("email","==",a.email));(await C(t)).forEach(h=>{g("user",{id:h.id,...h.data()})})}s()},[a.email]),l.useEffect(()=>{async function s(){const t=y(x,"categories"),o=A(t,P("status","==","approved")),h=await C(o);let R=[];h.forEach(D=>{R.push({id:D.id,...D.data()})}),L(R)}s()},[]);const M=Y(),Q=async s=>{if(!H||!b||!s.category||!w){p.error("Please fill full the option !",{theme:"colored",autoClose:2e3,pauseOnHover:!1});return}try{const t={...s};t.slug=ae(s.slug||s.title,{lower:!0});const o=y(x,"posts");await W(o,{...t,image:b,content:w,createdAt:X()}),p.success("Add new post successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),M("/manage/post"),B({title:"",slug:"",status:"pending",promote:"none",image:"",category:{},user:{}}),$(),k({})}catch{p.error("Failed to add new post !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}},_=async s=>{const t=Z(x,"categories",s.id),o=await ee(t);g("category",{id:o.id,...o.data()}),k(s)},J="95913b3beeb193701b10ab1aa5b6bfbf",z=l.useMemo(()=>({toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],imageUploader:{upload:async s=>{const t=new FormData;return t.append("image",s),(await le({method:"post",url:`https://api.imgbb.com/1/upload?key=${J}`,data:t,headers:{"Content-Type":"multipath/form-data"}})).data.data.url}}}),[]);return l.useEffect(()=>{var t;const s=Object.values(S);s.length>0&&p.error((t=s[0])==null?void 0:t.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[S]),e.jsxs("div",{children:[e.jsx(je,{children:"add new post"}),e.jsxs("form",{className:"pt-14",onSubmit:I(Q),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(c,{children:[e.jsx(d,{children:"Title ‚úíÔ∏è"}),e.jsx(xe,{control:r,placeholder:"Enter your title",name:"title"})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Category üì¶"}),e.jsxs(ne,{children:[e.jsx(ie,{placeholder:"Select Category"}),e.jsx(ce,{children:N.length>0&&N.map(s=>e.jsx(de,{onClick:()=>_(s),children:s.title},s.id))})]}),(n==null?void 0:n.title)&&e.jsx("span",{className:"inline-block p-3 text-sm font-medium text-blue-500 bg-blue-500 rounded-lg bg-opacity-20",children:`#${n==null?void 0:n.title}`})]})]}),e.jsxs("div",{className:"grid items-center grid-cols-2 mb-10 gap-x-10",children:[e.jsxs(c,{children:[e.jsx(d,{children:"Image "}),e.jsx(te,{onChange:q,handleDeleteImage:V,progress:U,image:b}),e.jsx("input",{type:"file",name:"image",className:"hidden-input"})]}),e.jsx("div",{className:"flex flex-col gap-10",children:((a==null?void 0:a.role)===O.ADMIN||(a==null?void 0:a.role)===O.MOD)&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Promote Post "}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(i,{name:"promote",control:r,checked:j===m.FEATURE,value:m.FEATURE,children:"Feature"}),e.jsx(i,{name:"promote",control:r,checked:j===m.BEST,value:m.BEST,children:"Best"}),e.jsx(i,{name:"promote",control:r,checked:j===m.HOT,value:m.HOT,children:"Hot"})]})]}),e.jsxs(c,{children:[e.jsx(d,{children:"Status "}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(i,{name:"status",control:r,checked:f===u.APPROVED,value:u.APPROVED,children:"Approved"}),e.jsx(i,{name:"status",control:r,checked:f===u.PENDING,value:u.PENDING,children:"Pending"}),e.jsx(i,{name:"status",control:r,checked:f===u.REJECTED,value:u.REJECTED,children:"Reject"})]})]})]})})]}),e.jsx("div",{className:"mb-10",children:e.jsxs(c,{children:[e.jsx(d,{children:"Content ‚úçÔ∏è"}),e.jsx("div",{className:"w-full entry-content",children:e.jsx(me,{className:"dark:text-white text-text1",modules:z,theme:"snow",value:w,onChange:G})})]})}),e.jsx(be,{id:"addpost",type:"submit",kind:"secondary",className:`w-[200px] mx-auto h-[65px]  ${v?"opacity-50 pointer-events-none":""}`,children:v?e.jsx(ge,{}):"add new post"})]}),e.jsx("a",{href:"#",children:e.jsx("div",{className:`${F} bottom-20 right-5`,children:e.jsx(we,{})})}),e.jsx("a",{href:"#addpost",children:e.jsx("div",{className:`${F} bottom-5 right-5`,children:e.jsx(ye,{})})})]})};export{Ie as default};
