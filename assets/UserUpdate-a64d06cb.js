import{u as B,m as _,e as Q,g as d,n as p,r as f,Q as g,j as e,d as n,_ as z,R as G,b as J,f as K,h as T}from"./index-c9fa4626.js";import{u as W,I as X}from"./ImageUpload-2dfcdb9c.js";import{R as x}from"./Radio-b88e30b8.js";import{c as Y,a as w,u as Z,F as j,L as v,I as U,b as ee,o as se}from"./yup-70539696.js";import{H as ae}from"./Heading-803c943e.js";import{B as re}from"./Button-7ee070cf.js";import{u as r}from"./constants-c6ed1daf.js";import"./index.esm-20135b09.js";const te=Y({username:w().required("Please enter your username"),slug:w().lowercase()}),pe=()=>{const{userInfo:c}=B(),{control:o,handleSubmit:D,watch:S,setValue:F,getValues:b,reset:R,formState:{isValid:O,isSubmitting:I,errors:N}}=Z({mode:"onchange",resolver:se(te)}),[k]=_(),t=k.get("id"),A=Q(),i=S("role"),m=b("avatar"),l=/%2F(\S+)\?/gm.exec(m),H=(l==null?void 0:l.length)>0?l[1]:"",{image:h,setImage:y,progress:M,handleSelectImage:C,handleDeleteImage:L}=W(F,b,H,V),P=async s=>{if(O)try{const a=d(n,"users",t);await p(a,{...s,avatar:h});const u=z(n,"posts"),$=G(u,J("user.id","==",c.uid));(await K($)).forEach(async E=>{const q=d(n,"posts",E.id);await p(q,{user:{...E.data().user,username:s.username,slug:s.slug,avatar:h}})}),g.success("Update user successfully !",{theme:"colored",autoClose:2e3,pauseOnHover:!1}),A("/dashboard")}catch{g.error("Failed to update user !",{theme:"colored",autoClose:2e3,pauseOnHover:!1})}};async function V(){const s=d(n,"users",t);await p(s,{avatar:""})}return f.useEffect(()=>{y(m)},[m,y]),f.useEffect(()=>{async function s(){if(!t)return;const a=d(n,"users",t),u=await T(a);R(u&&u.data())}s()},[R,t]),f.useEffect(()=>{var a;const s=Object.values(N);s.length>0&&g.error((a=s[0])==null?void 0:a.message,{theme:"colored",autoClose:2e3,pauseOnHover:!1})},[N]),t?e.jsxs("div",{children:[e.jsx(ae,{children:"update user"}),e.jsxs("form",{className:"pt-14",onSubmit:D(P),children:[e.jsx("div",{className:"w-[300px] h-[300px] mx-auto rounded-full mb-16",children:e.jsx(X,{className:"!rounded-full h-full",onChange:C,handleDeleteImage:L,progress:M,image:h,userImage:"true"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-10 mb-10",children:[e.jsxs(j,{children:[e.jsx(v,{children:"username ✒️"}),e.jsx(U,{control:o,placeholder:"Enter your username",name:"username"})]}),e.jsxs(j,{children:[e.jsx(v,{children:"slug ✒️"}),e.jsx(U,{control:o,placeholder:"Example: taketa-hana",name:"slug"})]})]}),e.jsx("div",{className:"grid grid-cols-2 mb-10 gap-x-10",children:(c==null?void 0:c.role)===r.ADMIN&&e.jsx(e.Fragment,{children:e.jsxs(j,{children:[e.jsx(v,{children:"role"}),e.jsxs("div",{className:"flex items-center gap-x-5",children:[e.jsx(x,{name:"role",control:o,checked:i===r.ADMIN,value:r.ADMIN,children:"admin"}),e.jsx(x,{name:"role",control:o,checked:i===r.MOD,value:r.MOD,children:"mod"}),e.jsx(x,{name:"role",control:o,checked:i===r.USER,value:r.USER,children:"user"})]})]})})}),e.jsx(re,{type:"submit",kind:"secondary",className:`w-[200px] mx-auto h-[65px]  ${I?"opacity-50 pointer-events-none":""}`,children:I?e.jsx(ee,{}):"update user"})]})]}):null};export{pe as default};
